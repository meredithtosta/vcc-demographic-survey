<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ company.company_name }} - Detail</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background: #f5f5f5;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .back-link {
            color: #0066cc;
            text-decoration: none;
            margin-bottom: 20px;
            display: inline-block;
        }

        h1 {
            color: #1a1a1a;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #666;
            margin-bottom: 30px;
        }

        .card {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .stat-box {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 6px;
            text-align: center;
        }

        .stat-value {
            font-size: 32px;
            font-weight: bold;
            color: #0066cc;
        }

        .stat-label {
            font-size: 14px;
            color: #666;
            margin-top: 5px;
        }

        .data-section {
            margin: 30px 0;
        }

        .data-section h3 {
            margin-bottom: 15px;
            color: #1a1a1a;
            border-bottom: 2px solid #eee;
            padding-bottom: 10px;
        }

        .data-row {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid #eee;
        }

        .data-row:last-child {
            border-bottom: none;
        }

        .data-label {
            color: #666;
        }

        .data-value {
            font-weight: 600;
            color: #1a1a1a;
        }

        .warning {
            background: #fff3cd;
            border: 2px solid #ffc107;
            padding: 15px;
            border-radius: 4px;
            margin: 20px 0;
        }

        .success {
            background: #d4edda;
            border: 2px solid #28a745;
            padding: 15px;
            border-radius: 4px;
            margin: 20px 0;
        }

        .note {
            background: #e7f3ff;
            border-left: 4px solid #0066cc;
            padding: 15px;
            margin: 20px 0;
            font-size: 14px;
            color: #004085;
        }
    </style>
</head>
<body>
    <div class="container">
        <a href="/admin/companies" class="back-link">← Back to Companies</a>

        <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 10px;">
            <h1 style="margin: 0;">{{ company.company_name }}</h1>
            <button onclick="document.getElementById('editNameForm').style.display='flex'" style="padding: 4px 10px; background: #e9ecef; border: 1px solid #ddd; border-radius: 3px; cursor: pointer; font-size: 12px;">✏️ Edit</button>
        </div>
        <form id="editNameForm" method="POST" action="/admin/company/{{ company.id }}/update_name" style="display: none; align-items: center; gap: 10px; margin-bottom: 15px;">
            <input type="text" name="company_name" value="{{ company.company_name }}" style="padding: 8px; border: 1px solid #ddd; border-radius: 4px; font-size: 16px; width: 300px;">
            <button type="submit" style="padding: 8px 15px; background: #0066cc; color: white; border: none; border-radius: 4px; cursor: pointer;">Save</button>
            <button type="button" onclick="document.getElementById('editNameForm').style.display='none'" style="padding: 8px 15px; background: #6c757d; color: white; border: none; border-radius: 4px; cursor: pointer;">Cancel</button>
        </form>
        <div class="subtitle">Investment Year: {{ company.investment_year }}</div>

        {% if aggregated %}
        <div class="card">
            <h2>Response Overview</h2>
            <div class="stats-grid">
                <div class="stat-box">
                    <div class="stat-value">{{ aggregated.total_founders }}</div>
                    <div class="stat-label">Total Founders</div>
                    <form method="POST" action="/admin/company/{{ company.id }}/update_founders" style="margin-top: 10px;">
                        <input type="number" name="total_founders" value="{{ aggregated.total_founders }}" min="1" max="50" style="width: 60px; padding: 4px; text-align: center; border: 1px solid #ddd; border-radius: 3px;">
                        <button type="submit" style="padding: 4px 8px; background: #0066cc; color: white; border: none; border-radius: 3px; cursor: pointer; font-size: 12px;">Update</button>
                    </form>
                </div>
                <div class="stat-box">
                    <div class="stat-value">{{ aggregated.total_responses }}</div>
                    <div class="stat-label">Responses Received</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value">
                        {% if aggregated.total_founders > 0 %}
                            {{ "%.0f"|format((aggregated.total_responses / aggregated.total_founders) * 100) }}%
                        {% else %}
                            0%
                        {% endif %}
                    </div>
                    <div class="stat-label">Response Rate</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value">{{ aggregated.total_declined_all }}</div>
                    <div class="stat-label">Declined to Answer</div>
                </div>
            </div>

            {% if aggregated.is_primarily_diverse %}
                <div class="success">
                    <strong>✓ Primarily Diverse:</strong> Based on responses, this company has a primarily diverse founding team.
                </div>
            {% elif aggregated.is_primarily_diverse == False %}
                <div class="warning">
                    <strong>Not Primarily Diverse:</strong> Based on responses, this company does not qualify as primarily diverse.
                </div>
            {% else %}
                <div class="warning">
                    <strong>Insufficient Data:</strong> Not enough responses to determine diverse status (need >50% response rate).
                </div>
            {% endif %}
        </div>

        <div class="note">
            <strong>Privacy Note:</strong> This page shows only aggregated, anonymized data. Individual responses are encrypted and stored separately for DFPI compliance. Response counts below may sum to more than the total number of responses because founders can select multiple options.
        </div>

        <div class="card">
            <div class="data-section">
                <h3>Gender Identity</h3>
                <div class="data-row">
                    <span class="data-label">Woman</span>
                    <span class="data-value">{{ aggregated.gender_woman }}</span>
                </div>
                <div class="data-row">
                    <span class="data-label">Man</span>
                    <span class="data-value">{{ aggregated.gender_man }}</span>
                </div>
                <div class="data-row">
                    <span class="data-label">Nonbinary</span>
                    <span class="data-value">{{ aggregated.gender_nonbinary }}</span>
                </div>
                <div class="data-row">
                    <span class="data-label">Transgender</span>
                    <span class="data-value">{{ aggregated.gender_transgender }}</span>
                </div>
                <div class="data-row">
                    <span class="data-label">Other</span>
                    <span class="data-value">{{ aggregated.gender_other }}</span>
                </div>
                <div class="data-row">
                    <span class="data-label">Declined to State</span>
                    <span class="data-value">{{ aggregated.gender_declined }}</span>
                </div>
            </div>

            <div class="data-section">
                <h3>Race/Ethnicity</h3>
                <div class="data-row">
                    <span class="data-label">Black or African American</span>
                    <span class="data-value">{{ aggregated.race_black }}</span>
                </div>
                <div class="data-row">
                    <span class="data-label">Asian</span>
                    <span class="data-value">{{ aggregated.race_asian }}</span>
                </div>
                <div class="data-row">
                    <span class="data-label">Hispanic or Latino/Latina</span>
                    <span class="data-value">{{ aggregated.race_hispanic }}</span>
                </div>
                <div class="data-row">
                    <span class="data-label">Native American or Alaskan Native</span>
                    <span class="data-value">{{ aggregated.race_native_american }}</span>
                </div>
                <div class="data-row">
                    <span class="data-label">Native Hawaiian or Pacific Islander</span>
                    <span class="data-value">{{ aggregated.race_pacific_islander }}</span>
                </div>
                <div class="data-row">
                    <span class="data-label">White</span>
                    <span class="data-value">{{ aggregated.race_white }}</span>
                </div>
                <div class="data-row">
                    <span class="data-label">Other</span>
                    <span class="data-value">{{ aggregated.race_other }}</span>
                </div>
                <div class="data-row">
                    <span class="data-label">Declined to State</span>
                    <span class="data-value">{{ aggregated.race_declined }}</span>
                </div>
            </div>

            <div class="data-section">
                <h3>LGBTQ+ Identity</h3>
                <div class="data-row">
                    <span class="data-label">LGBTQ+</span>
                    <span class="data-value">{{ aggregated.lgbtq_yes }}</span>
                </div>
                <div class="data-row">
                    <span class="data-label">Not LGBTQ+</span>
                    <span class="data-value">{{ aggregated.lgbtq_no }}</span>
                </div>
                <div class="data-row">
                    <span class="data-label">Declined to State</span>
                    <span class="data-value">{{ aggregated.lgbtq_declined }}</span>
                </div>
            </div>

            <div class="data-section">
                <h3>Disability Status</h3>
                <div class="data-row">
                    <span class="data-label">Person with a Disability</span>
                    <span class="data-value">{{ aggregated.disability_yes }}</span>
                </div>
                <div class="data-row">
                    <span class="data-label">Not a Person with a Disability</span>
                    <span class="data-value">{{ aggregated.disability_no }}</span>
                </div>
                <div class="data-row">
                    <span class="data-label">Declined to State</span>
                    <span class="data-value">{{ aggregated.disability_declined }}</span>
                </div>
            </div>

            <div class="data-section">
                <h3>Veteran Status</h3>
                <div class="data-row">
                    <span class="data-label">Veteran</span>
                    <span class="data-value">{{ aggregated.veteran_yes }}</span>
                </div>
                <div class="data-row">
                    <span class="data-label">Disabled Veteran</span>
                    <span class="data-value">{{ aggregated.veteran_disabled }}</span>
                </div>
                <div class="data-row">
                    <span class="data-label">Not a Veteran</span>
                    <span class="data-value">{{ aggregated.veteran_no }}</span>
                </div>
                <div class="data-row">
                    <span class="data-label">Declined to State</span>
                    <span class="data-value">{{ aggregated.veteran_declined }}</span>
                </div>
            </div>

            <div class="data-section">
                <h3>California Residency</h3>
                <div class="data-row">
                    <span class="data-label">California Resident</span>
                    <span class="data-value">{{ aggregated.ca_resident_yes }}</span>
                </div>
                <div class="data-row">
                    <span class="data-label">Not a California Resident</span>
                    <span class="data-value">{{ aggregated.ca_resident_no }}</span>
                </div>
                <div class="data-row">
                    <span class="data-label">Declined to State</span>
                    <span class="data-value">{{ aggregated.ca_resident_declined }}</span>
                </div>
            </div>
        </div>
        {% else %}
        <div class="warning">
            <strong>No responses yet.</strong> Share the survey link with founding team members to collect data.
        </div>
        {% endif %}

        <div class="card">
            <h3>Survey Link</h3>
            <p style="margin: 15px 0;">Share this link with founding team members:</p>
            <div style="background: #f8f9fa; padding: 15px; border-radius: 4px; font-family: monospace; word-break: break-all;">
                {{ request.host_url }}survey/{{ company.survey_link_token }}
            </div>
            <button onclick="copyLink('{{ request.host_url }}survey/{{ company.survey_link_token }}')" style="margin-top: 15px; background: #0066cc; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer;">
                Copy Link
            </button>
        </div>

        <div class="card" style="border: 2px solid #dc3545; margin-top: 30px;">
            <h3 style="color: #dc3545;">Danger Zone</h3>
            <p style="margin: 15px 0;">Permanently delete this company and all its survey responses.</p>
            <form method="POST" action="/admin/company/{{ company.id }}/delete" onsubmit="return confirm('Are you sure you want to delete this company? This cannot be undone.');">
                <button type="submit" style="background: #dc3545; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer;">
                    Delete Company
                </button>
            </form>
        </div>
    </div>

    <script>
        function copyLink(link) {
            navigator.clipboard.writeText(link).then(() => {
                alert('Survey link copied to clipboard!');
            });
        }
    </script>
</body>
</html>